<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hotel POS System</title>
    <link rel="stylesheet" href="./dist/output.css" />

    <!-- Firebase SDK Versi 8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  </head>
  <body
    class="flex items-center justify-center bg-gray-800 h-screen text-gray-900"
  >
    <div class="container" id="container">
      <!-- Registrasi -->
      <div class="form-container register-container">
        <form id="registerForm">
          <h1>Daftar</h1>
          <input type="text" placeholder="Nama Pengguna" id="regUsername" />
          <input type="email" placeholder="Email" id="regEmail" />
          <input type="number" placeholder="Nomor Telepon" id="regPhone" />
          <input type="password" placeholder="Kata Sandi" id="regPassword" />
          <button type="submit">Daftar</button>
        </form>
      </div>

      <!-- Login -->
      <div class="form-container login-container">
        <form id="loginForm">
          <h1>Masuk</h1>
          <input type="email" placeholder="Email" id="loginEmail" />
          <input type="password" placeholder="Kata Sandi" id="loginPassword" />
          <button type="submit">Masuk</button>
        </form>
      </div>

      <!-- Overlay -->
      <div class="overlay-container">
        <div class="overlay">
          <div class="overlay-panel overlay-left">
            <h1>Selamat Datang Kembali!</h1>
            <p>Untuk tetap terhubung dengan kami, silakan login</p>
            <button class="ghost" id="login">Masuk</button>
          </div>
          <div class="overlay-panel overlay-right">
            <h1>Halo, Teman!</h1>
            <p>Buat akun Anda dan mulai perjalanan baru bersama kami</p>
            <button class="ghost" id="register">Daftar</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyB4BKM35Qy-rf0dlfqiqyWzs9AwUZq0ojA",
        authDomain: "prog4-34938.firebaseapp.com",
        projectId: "prog4-34938",
        storageBucket: "prog4-34938.appspot.com",
        messagingSenderId: "920234132726",
        appId: "1:920234132726:web:4439c637de33ddf4f3d8d7",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      // Registrasi
      document
        .getElementById("registerForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Ambil data input dari form
          const username = document.getElementById("regUsername").value.trim();
          const email = document.getElementById("regEmail").value.trim();
          const phone = document.getElementById("regPhone").value.trim();
          const password = document.getElementById("regPassword").value;

          if (!username || !email || !phone || !password) {
            alert("Semua kolom harus diisi!");
            return;
          }

          // Registrasi dengan Firebase Authentication
          auth
            .createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
              const user = userCredential.user;

              // Simpan data tambahan ke Firestore
              return db.collection("users").doc(user.uid).set({
                username: username,
                email: email,
                phone: phone,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              });
            })
            .then(() => {
              alert("Registrasi berhasil! Silakan login.");
              document.getElementById("registerForm").reset();
              document
                .getElementById("container")
                .classList.remove("right-panel-active");
            })
            .catch((error) => {
              alert("Registrasi gagal: " + error.message);
              console.error("Error saat registrasi:", error);
            });
        });

      // Login
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const loginEmail = document.getElementById("loginEmail").value;
          const loginPassword = document.getElementById("loginPassword").value;

          // Login menggunakan Firebase Authentication
          auth
            .signInWithEmailAndPassword(loginEmail, loginPassword)
            .then((userCredential) => {
              const user = userCredential.user;

              // Ambil data user dari Firestore
              db.collection("users")
                .doc(user.uid)
                .get()
                .then((doc) => {
                  if (doc.exists) {
                    alert("Login berhasil!");
                    // Simpan data di localStorage
                    localStorage.setItem("isLoggedIn", "true");
                    localStorage.setItem(
                      "currentUser",
                      JSON.stringify(doc.data())
                    );
                    window.location.href = "./employee.html"; // Halaman tujuan setelah login
                  } else {
                    alert("Data pengguna tidak ditemukan!");
                  }
                });
            })
            .catch((error) => {
              alert("Email atau kata sandi salah!");
              console.error("Error saat login:", error.message);
            });
        });

      document.addEventListener("DOMContentLoaded", () => {
        // Referensi elemen
        const registerForm = document.querySelector(".register-container form");
        const loginForm = document.querySelector(".login-container form");
        const registerButton = document.getElementById("register");
        const loginButton = document.getElementById("login");
        const container = document.getElementById("container");
        const backButton = document.getElementById("back-btn");

        // Toggle antara login dan registrasi
        registerButton.addEventListener("click", () => {
          container.classList.add("right-panel-active");
        });

        loginButton.addEventListener("click", () => {
          container.classList.remove("right-panel-active");
        });

        // Navigasi tombol kembali ke halaman utama
        backButton.addEventListener("click", () => {
          window.location.href = "../index.html";
        });

        // Fungsi untuk menyimpan data registrasi
        registerForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const username = registerForm
            .querySelector('input[placeholder="Nama Pengguna"]')
            .value.trim();
          const email = registerForm
            .querySelector('input[placeholder="Email"]')
            .value.trim();
          const phone = registerForm
            .querySelector('input[placeholder="Nomor Telepon"]')
            .value.trim();
          const password = registerForm.querySelector(
            'input[placeholder="Kata Sandi"]'
          ).value;

          if (username && email && phone && password) {
            const userData = { username, email, phone, password };
            localStorage.setItem("user", JSON.stringify(userData));
            alert("Registrasi berhasil! Silakan login.");
            container.classList.remove("right-panel-active"); // Pindah ke form login
          } else {
            alert("Semua kolom harus diisi.");
          }
        });

        // Fungsi untuk login
        loginForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const username = loginForm
            .querySelector('input[placeholder="Nama Pengguna"]')
            .value.trim();
          const password = loginForm.querySelector(
            'input[placeholder="Kata Sandi"]'
          ).value;

          const savedUser = JSON.parse(localStorage.getItem("user"));

          if (
            savedUser &&
            savedUser.username === username &&
            savedUser.password === password
          ) {
            // Periksa huruf pertama dari username
            const firstChar = username.charAt(0).toLowerCase(); // Konversi ke huruf kecil
            if (firstChar === "a") {
              alert("Login berhasil sebagai admin!");
              window.location.href = "dashboardadmin.html"; // Alihkan ke Dashboard Admin
            } else {
              alert("Login berhasil!");
              window.location.href = "Home.html"; // Alihkan ke Home
            }
          } else {
            alert("Nama pengguna atau kata sandi salah.");
          }
        });
      });
    </script>
  </body>
</html>
